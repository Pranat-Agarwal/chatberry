<!DOCTYPE html>
<html>
<head>
<title>History - ChatBerry</title>
<style>
body {
  background:#0f172a;
  color:white;
  font-family:Segoe UI;
  padding:20px;
}

h2 {
  margin-bottom: 20px;
}

.card {
  background:#020617;
  padding:15px;
  margin-bottom:15px;
  border-radius:8px;
  border: 1px solid #1e293b;
}

.time {
  font-size: 12px;
  opacity: 0.6;
  margin-top: 8px;
}
</style>
</head>
<body>

<h2>Your Chat History</h2>
<div id="history"></div>

<script src="/static/auth.js"></script>
<script>
requireLogin();

const container = document.getElementById("history");

async function loadHistory() {
  const res = await fetch("/api/v1/history", {
    headers: {
      ...getAuthHeaders()
    }
  });

  if (!res.ok) {
    container.innerHTML = "<p>Failed to load history</p>";
    return;
  }

  const history = await res.json();

  if (history.length === 0) {
    container.innerHTML = "<p>No chat history yet.</p>";
    return;
  }

  history.forEach(h => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <b>You:</b><br>${h.message}<br><br>
      <b>ChatBerry:</b><br>${h.response}
      <div class="time">${new Date(h.created_at).toLocaleString()}</div>
    `;
    container.appendChild(div);
  });
}

loadHistory();
</script>

</body>
</html>
